#!/usr/bin/env python
# Copyright 2014 David Logie
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2 as
# published by the Free Software Foundation.
"""
Usage: artless <dir> [<dir> ..]
"""
import os
import sys

from mutagen import File


EXTENSIONS = ['.flac', '.mp3', '.m4a', '.mp4']
TAGS = ['APIC:', 'covr']


def echo(msg=''):
    sys.stdout.write(msg + '\n')
    sys.stdout.flush()


def check_track(track):
    if getattr(track, 'pictures', None):
        return True
    for t in TAGS:
        if t in track:
            return True
    return False


def main(*dirs):
    for d in dirs:
        for root, _, files in os.walk(d):
            for f in files:
                ext = os.path.splitext(f)[-1].lower()
                if ext not in EXTENSIONS:
                    continue
                fn = os.path.join(root, f)
                track = File(fn)
                if not check_track(track):
                    echo(fn)


if __name__ == '__main__':
    if len(sys.argv) < 2:
        echo(__doc__.strip())
        sys.exit(1)

    main(*sys.argv[1:])
