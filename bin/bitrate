#!/usr/bin/env python
# Copyright 2014 David Logie
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2 as
# published by the Free Software Foundation.
"""
Usage: bitrate [file...]
"""
import os
import sys

from mutagen.mp3 import MP3


EXTENSIONS = ['.mp3']


def echo(msg=''):
    sys.stdout.write(msg + '\n')
    sys.stdout.flush()


def main(*dirs):
    for d in dirs:
        if os.path.isfile(d):
            show_bitrate(d)
            continue

        for root, dirs, files in os.walk(d):
            dirs.sort()
            files.sort()
            for f in files:
                ext = os.path.splitext(f)[-1].lower()
                if ext not in EXTENSIONS:
                    continue
                track = MP3(os.path.join(root, f))
                echo("%s: %s kbps" % (track.filename, track.info.bitrate/1000))


if __name__ == '__main__':
    if len(sys.argv) < 2:
        echo(__doc__.strip())
        sys.exit(2)
    main(*sys.argv[1:])
