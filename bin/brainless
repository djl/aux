#!/usr/bin/env python
# Copyright 2014 David Logie
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2 as
# published by the Free Software Foundation.
"""
Usage: brainless <dir> [<dir> ..]
"""
import os
import sys

from mutagen.flac import FLAC
from mutagen.id3 import ID3
from mutagen.mp4 import MP4


NEEDLE = 'musicbrainz'
EXTENSIONS = {
    '.flac': FLAC,
    '.mp3': ID3,
    '.m4a': MP4
}


def check_track(fn):
    ext = os.path.splitext(fn)[-1]
    cls = EXTENSIONS[ext]
    track = cls(fn)
    for k in track.keys():
        if NEEDLE in k.lower():
            return True
    return False


def main(*dirs):
    for d in dirs:
        for root, _, files in os.walk(d):
            for f in files:
                if os.path.splitext(f)[-1] not in EXTENSIONS.keys():
                    continue
                fn = os.path.join(root, f)
                has_brains = check_track(fn)
                if not has_brains:
                    sys.stdout.write("%s\n" % fn)


if __name__ == '__main__':
    if len(sys.argv) < 2:
        sys.stdout.write(__doc__.lstrip())
        sys.exit(1)

    main(*sys.argv[1:])
